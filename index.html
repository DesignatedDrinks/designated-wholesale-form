<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Designated Drinks Wholesale Order Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; margin: 0; padding: 0; background: #f2f5f9; color: #333; }
    header { background: white; padding: 20px 30px 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); text-align: center; position: sticky; top: 0; z-index: 1000; }
    header h1 { font-size: 28px; margin: 0; color: #001f3f; }
    .submit-top { margin-top: 10px; }
    .submit-top button { background: #001f3f; color: white; padding: 10px 20px; font-size: 16px; border: none; border-radius: 6px; cursor: pointer; }
    .submit-top button:hover { background: #003366; }
    main { max-width: 1100px; margin: 0 auto; padding: 30px 20px; }
    .buyer-info, .product-row, .form-actions { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 20px; }
    .product-row { display: flex; flex-wrap: wrap; align-items: center; gap: 20px; }
    .product-row img { width: 90px; height: 90px; object-fit: contain; }
    .product-details { flex-grow: 1; }
    .product-title { font-weight: bold; font-size: 18px; margin-bottom: 4px; }
    .can-size { font-size: 14px; color: #555; }
    .qty-inputs { display: flex; flex-direction: column; gap: 6px; min-width: 100px; }
    .qty-inputs input { padding: 8px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; width: 100px; }
    .buyer-info label, .qty-inputs label { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .buyer-info input { padding: 10px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; width: 100%; margin-bottom: 15px; }
    .form-actions { text-align: center; }
    .form-actions button { background: #001f3f; color: white; padding: 14px 30px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; }
    .form-actions button:hover { background: #003366; }
    #totalBox { background: #fff4e5; padding: 15px; border-radius: 10px; text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 20px; }
  </style>
</head>
<body>
<form id="wholesaleForm">
  <header>
    <h1>Wholesale Order Form</h1>
    <div class="submit-top"><button type="submit">Submit Order</button></div>
  </header>
  <main>
    <div class="buyer-info">
      <label for="name">Full Name</label><input type="text" id="name" name="name" required>
      <label for="company">Company Name</label><input type="text" id="company" name="company" required>
      <label for="email">Email Address</label><input type="email" id="email" name="email" required>
    </div>
    <div id="productList"><!-- Products will load here --></div>
    <div id="totalBox">Total Estimate: $0.00</div>
    <div class="form-actions"><button type="submit">Submit Order</button></div>
  </main>
</form>
<script>
async function loadProducts() {
  const sheetUrl = 'https://docs.google.com/spreadsheets/d/17bcjrwi7Ah8_SXaPc9VrCIi2fdYnnNofmUoGy4LKBQ8/export?format=csv';
  try {
    const res = await fetch(sheetUrl);
    const csv = await res.text();
    if (!csv) throw new Error('Empty CSV');
    const rows = csv.split('\n').slice(1).map(r=>r.split(','));
    const list=document.getElementById('productList');
    rows.forEach(([title,canSize,,,imageUrl,price,status])=>{
      if(!title||status.trim().toLowerCase()!=='yes')return;
      const id=title.replace(/\s+/g,'_').toLowerCase();
      const div=document.createElement('div');div.className='product-row';
      div.innerHTML=`
        <img src="${imageUrl}" alt="${title}">
        <div class="product-details">
          <div class="product-title">${title}</div>
          <div class="can-size">${canSize}</div>
        </div>
        <div class="qty-inputs">
          <label for="${id}_cans">Cans</label>
          <input type="number" id="${id}_cans" name="${title}__cans" min="0" step="1" data-price="${parseFloat(price)}">
          <label for="${id}_cases">Cases</label>
          <input type="number" id="${id}_cases" name="${title}__cases" min="0" step="1" data-price="${(parseFloat(price)*24).toFixed(2)}">
        </div>`;
      list.appendChild(div);
    });
    list.addEventListener('input',updateTotal);
  }catch(err){
    console.error('Product load error:',err);
    document.getElementById('productList').innerHTML='<p style="color:red;">Error loading products. Please make the sheet public.</p>';
  }
}
function updateTotal(){
  let total=0;
  document.querySelectorAll('#productList input').forEach(inp=>{
    const qty=parseInt(inp.value)||0,price=parseFloat(inp.dataset.price)||0;
    total+=qty*price;
  });
  document.getElementById('totalBox').innerText=`Total Estimate: $${total.toFixed(2)}`;
}
document.getElementById('wholesaleForm').addEventListener('submit',async function(e){
  e.preventDefault();console.log('Submit clicked');
  const data=Object.fromEntries(new FormData(this).entries());
  try{
    const resp=await fetch('https://script.google.com/macros/s/AKfycby_osnVQU58RYUp7QIxdWytG6a-e9qZE0rpKjziNsf4egckPFITo_cWTCP9HJK7vdoDTA/exec',{method:'POST',body:JSON.stringify(data)});
    const text=await resp.text();console.log('Server response:',text);
    if(resp.ok){alert('Order submitted! A rep will contact you shortly.');this.reset();updateTotal();window.scrollTo(0,0);}else throw new Error('Network response was not OK');
  }catch(err){console.error('Submit error:',err);alert('Error submitting order. Check console.');}
});
loadProducts();
</script>
</body>
</html>
